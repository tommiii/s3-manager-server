"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const AWS = require("aws-sdk");
const libs_1 = require("../libs");
const { S3_BUCKET_NAME: Bucket, REGION: region } = process.env;
exports.uploadOnS3 = async (event) => {
    if (!event.body) {
        return libs_1.Response({ statusCode: 400, body: { message: "BadRequest" } });
    }
    try {
        const { base64, key } = JSON.parse(event.body);
        const s3 = new AWS.S3({ signatureVersion: "v4", region });
        const buffer = new Buffer(base64, "base64");
        const obj = {
            Body: buffer,
            Bucket: Bucket,
            ContentEncoding: "base64",
            Key: key,
        };
        const response = await s3.putObject(obj).promise();
        return libs_1.Response({ statusCode: 200, body: response });
    }
    catch (err) {
        if (err.statusCode === 403) {
            return libs_1.Response({ statusCode: 403, body: { message: "Access Denied" } });
        }
        return libs_1.Response({ statusCode: 500, body: { message: "InternalServerError" } });
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi91cGxvYWRPblMzL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsK0JBQWdDO0FBQ2hDLGtDQUFtQztBQVduQyxNQUFNLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQztBQUUvRCxPQUFPLENBQUMsVUFBVSxHQUFHLEtBQUssRUFBRSxLQUFzQixFQUFnQixFQUFFO0lBQ2xFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFO1FBQUUsT0FBTyxlQUFRLENBQUMsRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFLE9BQU8sRUFBRSxZQUFZLEVBQUUsRUFBRSxDQUFDLENBQUM7S0FBRTtJQUUzRixJQUFJO1FBQ0YsTUFBTSxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMvQyxNQUFNLEVBQUUsR0FBVyxJQUFJLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxnQkFBZ0IsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztRQUNsRSxNQUFNLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDNUMsTUFBTSxHQUFHLEdBQWE7WUFDcEIsSUFBSSxFQUFFLE1BQU07WUFDWixNQUFNLEVBQUUsTUFBZ0I7WUFDeEIsZUFBZSxFQUFFLFFBQVE7WUFDekIsR0FBRyxFQUFFLEdBQUc7U0FDVCxDQUFDO1FBQ0YsTUFBTSxRQUFRLEdBQUcsTUFBTSxFQUFFLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ25ELE9BQU8sZUFBUSxDQUFDLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQztLQUN0RDtJQUFDLE9BQU8sR0FBRyxFQUFFO1FBQ1osSUFBSSxHQUFHLENBQUMsVUFBVSxLQUFLLEdBQUcsRUFBRTtZQUMxQixPQUFPLGVBQVEsQ0FBQyxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLEVBQUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxFQUFFLENBQUMsQ0FBQztTQUMxRTtRQUNELE9BQU8sZUFBUSxDQUFDLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsRUFBRSxDQUFDLENBQUM7S0FDaEY7QUFDSCxDQUFDLENBQUMifQ==