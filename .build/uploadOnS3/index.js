"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const AWS = require("aws-sdk");
const Response = (args) => {
    const { statusCode, body, cors } = args;
    const response = {
        body: JSON.stringify(body),
        statusCode,
    };
    if (cors) {
        response.headers = {
            "Access-Control-Allow-Origin": "*",
            "Access-Control-Max-Age": 600,
        };
    }
    return response;
};
const { S3_BUCKET_NAME: Bucket, REGION: region } = process.env;
exports.uploadOnS3 = async (event) => {
    if (!event.body) {
        return Response({ statusCode: 400, body: { message: "BadRequest" } });
    }
    try {
        const { base64, key } = JSON.parse(event.body);
        const s3 = new AWS.S3({ signatureVersion: "v4", region });
        const buffer = new Buffer(base64, "base64");
        const obj = {
            Body: buffer,
            Bucket: Bucket,
            ContentEncoding: "base64",
            Key: key,
        };
        await s3.putObject(obj).promise();
    }
    catch (err) {
        return Response({ statusCode: 500, body: { message: "InternalServerError" } });
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi91cGxvYWRPblMzL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsK0JBQWdDO0FBa0JoQyxNQUFNLFFBQVEsR0FBRyxDQUFDLElBQWMsRUFBRSxFQUFFO0lBQ2xDLE1BQU0sRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQztJQUN4QyxNQUFNLFFBQVEsR0FBYTtRQUN6QixJQUFJLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUM7UUFDMUIsVUFBVTtLQUNYLENBQUM7SUFDRixJQUFJLElBQUksRUFBRTtRQUNSLFFBQVEsQ0FBQyxPQUFPLEdBQUc7WUFDakIsNkJBQTZCLEVBQUUsR0FBRztZQUNsQyx3QkFBd0IsRUFBRSxHQUFHO1NBQzlCLENBQUM7S0FDSDtJQUNELE9BQU8sUUFBUSxDQUFDO0FBQ2xCLENBQUMsQ0FBQztBQUVGLE1BQU0sRUFBRSxjQUFjLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDO0FBRS9ELE9BQU8sQ0FBQyxVQUFVLEdBQUcsS0FBSyxFQUFFLEtBQXNCLEVBQWdCLEVBQUU7SUFDbEUsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUU7UUFBRSxPQUFPLFFBQVEsQ0FBQyxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLEVBQUUsT0FBTyxFQUFFLFlBQVksRUFBRSxFQUFFLENBQUMsQ0FBQztLQUFFO0lBQzNGLElBQUk7UUFDRixNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQy9DLE1BQU0sRUFBRSxHQUFXLElBQUksR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLGdCQUFnQixFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQ2xFLE1BQU0sTUFBTSxHQUFHLElBQUksTUFBTSxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztRQUM1QyxNQUFNLEdBQUcsR0FBYTtZQUNwQixJQUFJLEVBQUUsTUFBTTtZQUNaLE1BQU0sRUFBRSxNQUFnQjtZQUN4QixlQUFlLEVBQUUsUUFBUTtZQUN6QixHQUFHLEVBQUUsR0FBRztTQUNULENBQUM7UUFDRixNQUFNLEVBQUUsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7S0FDbkM7SUFBQyxPQUFPLEdBQUcsRUFBRTtRQUNaLE9BQU8sUUFBUSxDQUFDLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsRUFBRSxDQUFDLENBQUM7S0FDaEY7QUFDSCxDQUFDLENBQUMifQ==